<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leaflet Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css"
    />
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      /* Pastikan map memenuhi seluruh tinggi parent */
      #map {
        flex-grow: 1;
        height: 100%;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map" style="width: 100%; height: 400px"></div>
    <script>
      var map = L.map("map").setView(
        [-0.4827527195626835, 117.18218840574627],
        12
      );

      // Layer ArcGIS World Imagery
      var arcGISLayer = L.tileLayer(
        "https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
        {
          attribution: "Â© OpenStreetMap contributors",
        }
      );

      var bingMapsLayer = L.tileLayer(
        "http://ecn.t3.tiles.virtualearth.net/tiles/a{q}.jpeg?g=1",
        {
          subdomains: ['t0', 't1', 't2', 't3'],
          maxZoom: 21,
          attribution: "Bing"
        }
      )
      // bing.addTo(map)
      
      var googleSateliteLayer = L.tileLayer(
        "https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",
        {
          maxZoom: 21,
          attribution: "Google",
          tileSize: 256,
        }
      )
      // google.addTo(map)

      // Tambahkan layer ArcGIS secara default ke peta
      arcGISLayer.addTo(map);


      // Tambahkan kontrol layer untuk memungkinkan pengguna memilih antara dua layer
      var baseLayers = {
        "ArcGIS World Imagery": arcGISLayer,
        "Bing": bingMapsLayer,
        "Google": googleSateliteLayer,
      };

      L.control.layers(baseLayers).addTo(map);

      var drawnItems = new L.FeatureGroup();
      map.addLayer(drawnItems);
      var drawControl = new L.Control.Draw({
        edit: {
          featureGroup: drawnItems,
        },
        draw: {
          polygon: true,
          marker: false,
          circle: false,
          circlemarker: false,
          rectangle: true,
          polyline: false,
        },
      });
      map.addControl(drawControl);

      map.on("draw:created", function (e) {
        var layer = e.layer;
        drawnItems.addLayer(layer);
        var geojson = layer.toGeoJSON();
        if (window.pyqtChannel) {
          window.pyqtChannel.receiveGeoJSON(JSON.stringify(geojson));
        }
        console.log(JSON.stringify(layer.toGeoJSON()));
      });
      new QWebChannel(qt.webChannelTransport, function (channel) {
        window.pyqtChannel = channel.objects.pyqtChannel; // Pastikan channel terhubung
      });
    </script>
  </body>
</html>
